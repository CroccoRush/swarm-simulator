# Симулятор системы управления роем роботов одним пультом

## Описание проекта

Данный проект представляет собой симулятор системы управления роем роботов одним пультом, 
разработанный в рамках учебной практики. 
Целью проекта является моделирование поведения группы роботов и управление с единого пульта.

Симулятор основан на следующих ключевых компонентах:
- **ArduPilot SITL (Software-in-the-Loop):** для реалистичного моделирования автопилота каждого робота.
- **MAVProxy:** для управления MAVLink-соединениями.
- **Python:** основной язык реализации симулятора, включая управление роботами, симуляцию сети, 
  запуск экспериментов и обработку данных.
- **Bash-скрипты:** для оркестровки запуска и остановки всех компонентов симуляции.

Проект реализует трехуровневую архитектуру управления (Автопилот - Микроконтроллер - Базовая станция) 
и поддерживает два режима работы:
- **GUI Mode (`gui`):** интерактивное управление роем с помощью геймпада.
- **Experiment Mode (`experiment`):** автоматический запуск предопределенных сценариев для сбора данных 
  и сравнения алгоритмов.

## Требования и установка

Для сборки и запуска симулятора требуется Linux-совместимая система (тестировалось на Ubuntu/Debian-based) 
со следующими компонентами:

1.  **Основные утилиты:**
    ```bash
    sudo apt update
    sudo apt install git python3 python3-pip jq xterm curl
    ```

2.  **ArduPilot SITL:**
    Рекомендуется следовать официальной инструкции по установке SITL: [Setting up SITL on Linux](https://ardupilot.org/dev/docs/setting-up-sitl-on-linux.html) --- 
    заменив ссылку на github-репозиторий из официальной инструкции на https://github.com/aochernov/ardupilot-swarming.git 
    (для получения прав доступа к репозиторию следует обратиться к Киселеву Владимиру по почте st087340@student.spbu.ru). 
    Основные шаги включают клонирование репозитория ardupilot-swarming и установку зависимостей.
    ```bash
    git clone https://github.com/aochernov/ardupilot-swarming.git
    cd ardupilot
    git submodule update --init --recursive
    Tools/environment_install/install-prereqs-ubuntu.sh -y
    cd ..
    ```
    *Примечание: убедитесь, что версия ArduPilot совместима с используемыми параметрами (`.parm` файлы) 
     или обновите их при необходимости.*

3.  **MAVProxy:**
    ```bash
    pip3 install MAVProxy --user
    # Добавьте ~/.local/bin в ваш PATH, если еще не добавлено
    # echo 'export PATH="$PATH:$HOME/.local/bin"' >> ~/.bashrc
    # source ~/.bashrc
    ```

4.  **Зависимости Python:**
    Клонируйте этот репозиторий:
    ```bash
    git clone https://github.com/CroccoRush/swarm-simulator.git
    cd swarm-simulator
    ```
    Установите необходимые Python библиотеки:
    ```bash
    pip3 install -r requirements.txt
    ```

## Запуск симулятора

### Конфигурация

Перед запуском убедитесь, что:
- Файл `config.json` содержит корректные параметры для нужного количества роботов (ID, UDP/TCP порты, начальные позиции);
- Файлы параметров ArduPilot (`params/copter_*.parm`) существуют для каждого ID робота и содержат необходимые настройки;
- Путь к исполняемому файлу SITL (`SITL_BIN`) в `run_simulation.sh` указан верно (по умолчанию `./sitl/arducopter`). 
  Возможно, потребуется создать символическую ссылку или скопировать бинарный файл SITL из вашей сборки ArduPilot в папку `sitl`. 
  Пример:
    ```bash
    # Находясь в корне репозитория симулятора
    mkdir sitl
    # Замените <path_to_ardupilot> на ваш путь к папке ardupilot
    ln -s <path_to_ardupilot>/build/sitl/bin/arducopter sitl/arducopter
    ```

### Режимы запуска

Запуск осуществляется скриптом `run_simulation.sh` из корневой папки репозитория:

- **Интерактивный режим (с геймпадом):**
  ```bash
  ./run_simulation.sh gui
  ```

- **Режим Эксперимента:**
  ```bash
  ./run_simulation.sh experiment
  ```
  Этот режим используется скриптом `run_all_experiments.sh` для автоматического выполнения серий тестов.

### Завершение симуляции

Нажмите `Ctrl+C` в терминале, где был запущен `run_simulation.sh` или закройте окно с геймпадом, 
если вы запустили симулятор в интерактином режиме 

## Воспроизведение эксперимента

Эксперимент, описанный в тексте работы (сравнение алгоритмов LVP и ALVP для поддержания формации), 
можно воспроизвести следующим образом:

1.  **Настройка:** 
    убедитесь, что все шаги из раздела "Требования и Установка" выполнены, и конфигурация 
    (`config.json`, `.parm` файлы, путь к SITL) корректна для четырёх роботов.

2.  **Запуск серии экспериментов:**
    используйте скрипт `run_all_experiments.sh`. Этот скрипт по умолчанию запускает по 10 экспериментов 
    для двух наборов параметров (Set 1: LVP, Set 2: ALVP).
    ```bash
    ./run_all_experiments.sh
    ```
    *Примечание: Выполнение может занять продолжительное время.*

3.  **Обработка и визуализация результатов:**
    используйте функции из `app/proff.py` для анализа собранных логов.
    - Запустите Python интерпретатор или создайте отдельный скрипт;
    - Импортируйте необходимые функции из `app/proff.py`;
    - Используйте функцию `get_data(num_robots, suffix)` для загрузки данных конкретного эксперимента;
    - Используйте функции `plot_trajectories` и `plot_error` для визуализации траекторий и ошибок формации.


## Непрерывная интеграция (CI)

В проекте используются интерпретируемые языки (Python, Bash), поэтому настройка CI для проверки *компилируемости* не требуется.
